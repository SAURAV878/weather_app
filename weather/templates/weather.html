<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'light-bg': '#F0F4F8',
                        'light-card': '#FFFFFF',
                        'light-text': '#1E293B',
                        'dark-bg': '#0F172A',
                        'dark-card': '#1E293B',
                        'dark-text': '#E2E8F0',
                        'accent-blue': '#3B82F6',
                    },
                }
            }
        }
    </script>
    <style>
        @keyframes fade-slide-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse { 50% { opacity: .5; } }
        .animate-fade-slide-in { animation: fade-slide-in 0.5s ease-out forwards; }
        .skeleton { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; background-color: rgba(156, 163, 175, 0.2); border-radius: 0.5rem; }
        .hourly-scroll::-webkit-scrollbar { display: none; }
        .hourly-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-light-bg dark:bg-dark-bg text-light-text dark:text-dark-text font-sans transition-colors duration-300 overflow-x-hidden">

    <div class="max-w-screen-xl mx-auto p-4 sm:p-6 lg:p-8">
        <!-- HEADER -->
        <header class="flex justify-between items-center mb-8">
            <div class="flex items-center gap-3">
                <i class="fas fa-cloud-sun-rain text-3xl text-accent-blue"></i>
                <h1 class="text-2xl sm:text-3xl font-bold">Weather</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="theme-toggle" class="text-xl px-3 py-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-6">

            <!-- LEFT COLUMN (SEARCH & SAVED LOCATIONS) -->
            <aside class="lg:col-span-1 xl:col-span-1 space-y-6">
                <div class="bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md">
                    <div class="flex gap-2">
                        <input id="cityInput" type="text" placeholder="Search city..." class="w-full bg-light-bg dark:bg-dark-bg px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-accent-blue">
                        <button id="fetchWeatherBtn" class="bg-accent-blue text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"><i class="fas fa-search"></i></button>
                    </div>
                    <div id="errorBox" class="hidden bg-red-100 text-red-700 p-3 rounded-lg mt-4 text-sm"></div>
                </div>

                <div class="bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md">
                    <h2 class="text-lg font-semibold mb-3 flex items-center gap-2"><i class="fas fa-star text-yellow-400"></i> Saved Locations</h2>
                    <ul id="saved-locations" class="space-y-2">
                        <!-- JS will populate this -->
                        <li class="text-gray-500 dark:text-gray-400">No saved locations yet.</li>
                    </ul>
                </div>
            </aside>

            <!-- MAIN CONTENT (WEATHER DETAILS) -->
            <div class="lg:col-span-2 xl:col-span-3 space-y-6">
                <!-- SKELETON LOADER -->
                <div id="skeleton-loader" class="hidden space-y-6">
                    <div class="skeleton h-48 w-full"></div>
                    <div class="skeleton h-64 w-full"></div>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                        <div class="skeleton h-32"></div>
                        <div class="skeleton h-32"></div>
                        <div class="skeleton h-32"></div>
                        <div class="skeleton h-32"></div>
                    </div>
                </div>

                <!-- ACTUAL CONTENT -->
                <div id="weather-content" class="space-y-6 opacity-0">
                    <!-- CURRENT WEATHER -->
                    <div class="bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md">
                        <div class="flex flex-col sm:flex-row justify-between items-start">
                            <div>
                                <h2 class="text-3xl font-bold" id="cityName">--</h2>
                                <p class="text-gray-500 dark:text-gray-400" id="countryName">--</p>
                                <p class="text-lg mt-2" id="currentDesc">--</p>
                            </div>
                            <div class="flex items-center gap-4 mt-4 sm:mt-0">
                                <i id="currentIcon" class="text-6xl text-yellow-400"></i>
                                <p class="text-7xl font-light"><span id="currentTemp">--</span>°</p>
                                <select id="unitSelect" class="bg-light-bg dark:bg-dark-bg rounded-lg p-1 focus:outline-none focus:ring-2 focus:ring-accent-blue">
                                    <option value="celsius">C</option>
                                    <option value="fahrenheit">F</option>
                                </select>
                            </div>
                        </div>
                         <button id="save-location-btn" class="mt-4 text-sm text-accent-blue hover:underline"><i class="far fa-star"></i> Save Location</button>
                    </div>
                    
                    <!-- HOURLY FORECAST -->
                    <div class="bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md">
                        <h3 class="text-lg font-semibold mb-4">Hourly Forecast</h3>
                        <div id="hourly-forecast" class="flex overflow-x-auto gap-4 pb-2 hourly-scroll"></div>
                    </div>

                    <!-- 7-DAY & DETAILS GRID -->
                    <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
                        <!-- 7-DAY FORECAST -->
                        <div class="xl:col-span-2 bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md">
                            <h3 class="text-lg font-semibold mb-4">7-Day Forecast</h3>
                            <div id="forecast-list" class="space-y-3"></div>
                        </div>

                        <!-- MORE DETAILS -->
                        <div class="bg-light-card dark:bg-dark-card p-6 rounded-2xl shadow-md space-y-4">
                            <h3 id="details-toggle" class="text-lg font-semibold cursor-pointer flex justify-between items-center">
                                <span>Details</span>
                                <i id="details-arrow" class="fas fa-chevron-down transition-transform"></i>
                            </h3>
                            <div id="details-content" class="hidden pt-4 space-y-4 border-t border-gray-200 dark:border-gray-700">
                                 <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">Feels Like</span>
                                    <span id="detail-feels-like" class="font-semibold">--°</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">Wind</span>
                                    <span id="detail-wind" class="font-semibold">-- km/h</span>
                                </div>
                                 <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">Humidity</span>
                                    <span id="detail-humidity" class="font-semibold">--%</span>
                                </div>
                                 <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">Visibility</span>
                                    <span id="detail-visibility" class="font-semibold">-- km</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">UV Index</span>
                                    <span id="detail-uv" class="font-semibold">--</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-500 dark:text-gray-400">Air Quality</span>
                                    <span id="detail-aqi" class="font-semibold">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ALERTS -->
                    <div id="alert-section" class="hidden bg-yellow-100 dark:bg-yellow-900/50 border-l-4 border-yellow-500 text-yellow-700 dark:text-yellow-300 p-4 rounded-lg shadow-md">
                        <h3 class="font-bold mb-2">Alerts</h3>
                        <p id="alert-text">No active alerts.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DOM Elements ---
    const cityInput = document.getElementById("cityInput");
    const fetchWeatherBtn = document.getElementById("fetchWeatherBtn");
    const unitSelect = document.getElementById("unitSelect");
    const errorBox = document.getElementById("errorBox");
    const themeToggle = document.getElementById('theme-toggle');
    const hourlyForecastDiv = document.getElementById('hourly-forecast');
    const forecastListDiv = document.getElementById('forecast-list');
    const saveLocationBtn = document.getElementById('save-location-btn');
    const savedLocationsList = document.getElementById('saved-locations');
    const skeletonLoader = document.getElementById('skeleton-loader');
    const weatherContent = document.getElementById('weather-content');

    // --- State & Config ---
    let currentCity = null;
    let savedLocations = JSON.parse(localStorage.getItem('savedLocations')) || [];
    const icons = {
        "Clear": "fa-sun", "Clouds": "fa-cloud", "Rain": "fa-cloud-showers-heavy",
        "Drizzle": "fa-cloud-rain", "Thunderstorm": "fa-bolt", "Snow": "fa-snowflake",
        "Mist": "fa-smog", "Smoke": "fa-smog", "Haze": "fa-smog", "Dust": "fa-smog",
        "Fog": "fa-smog", "Sand": "fa-smog", "Ash": "fa-smog", "Squall": "fa-wind",
        "Tornado": "fa-tornado"
    };
    const defaultIcon = "fa-question-circle";

    // --- Initializer ---
    const init = () => {
        setupTheme();
        renderSavedLocations();
        const lastSearch = localStorage.getItem('lastWeatherSearch');
        // Removed automatic fetchWeather calls
        
        themeToggle.addEventListener('click', toggleTheme);
        fetchWeatherBtn.addEventListener("click", () => fetchWeather(cityInput.value.trim()));
        cityInput.addEventListener("keypress", e => e.key === "Enter" && fetchWeather(cityInput.value.trim()));
        saveLocationBtn.addEventListener('click', handleSaveLocation);
        unitSelect.addEventListener('change', () => {
            if(currentCity) fetchWeather(currentCity);
        });

        // The details section will now be controlled by clicking on a daily forecast item
        // const detailsToggle = document.getElementById('details-toggle');
        const detailsContent = document.getElementById('details-content');
        const detailsArrow = document.getElementById('details-arrow');
        detailsArrow.classList.remove('rotate-180'); // Ensure arrow points down initially

        // detailsToggle.addEventListener('click', () => {
        //     detailsContent.classList.toggle('hidden');
        //     detailsArrow.classList.toggle('rotate-180');
        // });
    };

    // --- Theme Management ---
    const setupTheme = () => {
        const userPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const savedTheme = localStorage.getItem('theme');
        if ((savedTheme === 'dark') || (!savedTheme && userPrefersDark)) {
            document.documentElement.classList.add('dark');
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            document.documentElement.classList.remove('dark');
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
    };
    const toggleTheme = () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        themeToggle.innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    };

    // --- UI & Rendering ---
    const showLoader = (show) => {
        skeletonLoader.classList.toggle('hidden', !show);
        if (show) {
            weatherContent.classList.add('opacity-0');
        } else {
            weatherContent.classList.remove('opacity-0');
            weatherContent.classList.add('animate-fade-slide-in');
        }
    };

    const showError = (msg) => {
        errorBox.classList.toggle("hidden", !msg);
        if (msg) errorBox.textContent = msg;
    };

    const renderSavedLocations = () => {
        savedLocationsList.innerHTML = "";
        if (savedLocations.length === 0) {
            savedLocationsList.innerHTML = `<li class="text-gray-500 dark:text-gray-400 text-sm">No saved locations.</li>`;
            return;
        }
        savedLocations.forEach(location => {
            const li = document.createElement('li');
            li.className = "flex justify-between items-center p-2 rounded-lg hover:bg-light-bg dark:hover:bg-dark-bg cursor-pointer";
            li.innerHTML = `<span>${location}</span><button data-location="${location}" class="delete-location-btn text-red-500 hover:text-red-700 text-xs"><i class="fas fa-trash"></i></button>`;
            li.addEventListener('click', (e) => {
                if (!e.target.closest('.delete-location-btn')) {
                    fetchWeather(location);
                }
            });
            savedLocationsList.appendChild(li);
        });
        document.querySelectorAll('.delete-location-btn').forEach(btn => btn.addEventListener('click', handleDeleteLocation));
    };
    
    // --- API & Data Handling ---
    async function fetchWeather(city) {
        if (!city) {
            showError("Please enter a city name.");
            return;
        }
        showLoader(true);
        showError(null);

        // Placeholder for backend API call
        // In a real app, you would fetch from your backend: `/api/weather?city=${city}&unit=${unitSelect.value}`
        // For now, we'll simulate a successful response with mock data after a short delay.
        setTimeout(() => {
            const mockData = generateMockData(city);
            displayWeather(mockData);
            localStorage.setItem('lastWeatherSearch', city);
            currentCity = city;
            showLoader(false);
        }, 1000);
    }
    
    // --- Location Management ---
    const handleSaveLocation = () => {
        if (!currentCity || savedLocations.includes(currentCity)) return;
        savedLocations.push(currentCity);
        localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
        renderSavedLocations();
        updateSaveButton();
    };
    const handleDeleteLocation = (e) => {
        const locationToDelete = e.currentTarget.dataset.location;
        savedLocations = savedLocations.filter(loc => loc !== locationToDelete);
        localStorage.setItem('savedLocations', JSON.stringify(savedLocations));
        renderSavedLocations();
        updateSaveButton();
    };

    const updateSaveButton = () => {
        if(savedLocations.includes(currentCity)) {
            saveLocationBtn.innerHTML = '<i class="fas fa-star"></i> Saved';
            saveLocationBtn.disabled = true;
        } else {
            saveLocationBtn.innerHTML = '<i class="far fa-star"></i> Save Location';
            saveLocationBtn.disabled = false;
        }
    }

    // --- Display Functions ---
    const updateDetails = (details) => {
        document.getElementById('detail-feels-like').textContent = `${details.feels_like}°`;
        document.getElementById('detail-wind').textContent = `${details.wind_speed} km/h`;
        document.getElementById('detail-humidity').textContent = `${details.humidity}%`;
        document.getElementById('detail-visibility').textContent = `${details.visibility} km`;
        document.getElementById('detail-uv').textContent = details.uv_index;
        document.getElementById('detail-aqi').textContent = `${details.aqi} - ${getAqiLabel(details.aqi)}`;
    };

    const displayWeather = (data) => {
        // Current Weather
        document.getElementById("cityName").textContent = data.city;
        document.getElementById("countryName").textContent = data.country;
        document.getElementById("currentTemp").textContent = data.current.temp;
        document.getElementById("currentDesc").textContent = data.current.description;
        document.getElementById("currentIcon").className = `text-6xl text-yellow-400 fas ${findIcon(data.current.main)}`;

        // Initial Details
        updateDetails(data.details);

        // Hourly
        hourlyForecastDiv.innerHTML = "";
        data.hourly.forEach(hour => {
            const card = document.createElement("div");
            card.className = "flex-shrink-0 text-center space-y-2 p-3";
            card.innerHTML = `
                <p class="text-sm text-gray-500 dark:text-gray-400">${hour.time}</p>
                <i class="fas ${findIcon(hour.main)}"></i>
                <p class="font-semibold">${hour.temp}°</p>`;
            hourlyForecastDiv.appendChild(card);
        });
        
        // 7-Day Forecast
        forecastListDiv.innerHTML = "";
        data.daily.forEach(day => {
            const item = document.createElement("div");
            item.className = "grid grid-cols-4 items-center gap-2 cursor-pointer hover:bg-light-bg dark:hover:bg-dark-bg rounded-lg p-2";
            item.innerHTML = `
                <p class="font-medium col-span-1">${day.day}</p>
                <div class="col-span-1 flex items-center gap-2">
                    <i class="fas ${findIcon(day.main)}"></i>
                    <span class="text-sm hidden sm:inline">${day.description}</span>
                </div>
                <div class="col-span-2 text-right">
                    <span class="font-semibold">${day.max_temp}°</span> / 
                    <span class="text-gray-500 dark:text-gray-400">${day.min_temp}°</span>
                </div>`;
            item.addEventListener('click', () => {
                updateDetails(day.details);
                // Optionally open the details section if it's closed
                const detailsContent = document.getElementById('details-content');
                if (detailsContent.classList.contains('hidden')) {
                    detailsContent.classList.remove('hidden');
                    document.getElementById('details-arrow').classList.add('rotate-180');
                }
            });
            forecastListDiv.appendChild(item);
        });
        
        // Alerts
        const alertSection = document.getElementById('alert-section');
        if (data.alerts && data.alerts.length > 0) {
            document.getElementById('alert-text').textContent = data.alerts.join("\n");
            alertSection.classList.remove('hidden');
        } else {
            alertSection.classList.add('hidden');
        }

        updateSaveButton();
    };

    // --- Helpers ---
    const findIcon = (mainDesc) => icons[mainDesc] || defaultIcon;
    const getAqiLabel = (aqi) => {
        if (aqi <= 50) return "Good";
        if (aqi <= 100) return "Moderate";
        if (aqi <= 150) return "Unhealthy for Some";
        if (aqi <= 200) return "Unhealthy";
        if (aqi <= 300) return "Very Unhealthy";
        return "Hazardous";
    };

    // --- Mock Data Generator ---
    const generateMockData = (city) => {
        const days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
        const weather = ["Clear", "Clouds", "Rain", "Snow"];
        const now = new Date();
        return {
            city: city.charAt(0).toUpperCase() + city.slice(1),
            country: city.toLowerCase() === 'newyork' ? 'USA' : 'Country',
            current: {
                temp: Math.floor(Math.random() * 20 + 10),
                description: "Partly Cloudy",
                main: "Clouds",
            },
            details: {
                feels_like: Math.floor(Math.random() * 20 + 9),
                wind_speed: (Math.random() * 20).toFixed(1),
                humidity: Math.floor(Math.random() * 50 + 40),
                visibility: (Math.random() * 10).toFixed(1),
                uv_index: Math.floor(Math.random() * 11),
                aqi: Math.floor(Math.random() * 200),
            },
            hourly: Array.from({ length: 12 }, (_, i) => ({
                time: `${(now.getHours() + i + 1) % 24}:00`,
                main: weather[Math.floor(Math.random() * weather.length)] ,
                temp: Math.floor(Math.random() * 20 + 10),
            })),
            daily: Array.from({ length: 7 }, (_, i) => {
                const dayIndex = (now.getDay() + i) % 7;
                return {
                    day: days[dayIndex],
                    description: weather[Math.floor(Math.random() * weather.length)],
                    main: weather[Math.floor(Math.random() * weather.length)],
                    max_temp: Math.floor(Math.random() * 15 + 15),
                    min_temp: Math.floor(Math.random() * 10 + 5),
                    details: {
                        feels_like: Math.floor(Math.random() * 20 + 9),
                        wind_speed: (Math.random() * 20).toFixed(1),
                        humidity: Math.floor(Math.random() * 50 + 40),
                        visibility: (Math.random() * 10).toFixed(1),
                        uv_index: Math.floor(Math.random() * 11),
                        aqi: Math.floor(Math.random() * 200),
                    }
                };
            }),
            alerts: Math.random() > 0.8 ? ["High wind warning for coastal areas."] : []
        };
    };

    init();
});
</script>
</body>
</html>