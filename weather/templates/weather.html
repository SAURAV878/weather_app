<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gradient-to-br from-blue-500 to-indigo-700 min-h-screen flex items-center justify-center p-6">

    <div class="bg-white/20 backdrop-blur-xl shadow-2xl rounded-3xl p-8 w-full max-w-3xl text-white">

        <!-- Header -->
        <h1 class="text-4xl font-bold text-center mb-6">ðŸŒ¤ Weather App</h1>

        <!-- Search Form -->
        <div class="flex gap-3 mb-6">
            <input id="cityInput" type="text"
                   class="w-full bg-white/30 text-white p-3 rounded-xl placeholder-white/60 focus:outline-none"
                   placeholder="Enter any city e.g. Tokyo, New York, Kathmandu">
            
            <select id="unitSelect" class="bg-white/30 text-white p-3 rounded-xl focus:outline-none">
                <option value="celsius">Celsius (Â°C)</option>
                <option value="fahrenheit">Fahrenheit (Â°F)</option>
            </select>

            <button onclick="getWeather()"
                class="bg-white text-blue-600 px-5 py-3 rounded-xl font-semibold hover:bg-gray-100">
                Get Weather
            </button>
        </div>

        <div id="result"></div>

    </div>


<script>

async function getWeather() {
    const city = document.getElementById("cityInput").value;
    const unit = document.getElementById("unitSelect").value;

    if (!city) {
        alert("Please enter a city!");
        return;
    }

    document.getElementById("result").innerHTML =
        `<p class='text-center text-lg'>Loading weather...</p>`;

    const url = `/api/weather/?city=${city}&unit=${unit}&days=7`;
    
    try {
        const res = await fetch(url);
        const data = await res.json();

        if (data.error) {
            document.getElementById("result").innerHTML =
                `<p class='text-center text-red-300 text-xl'>${data.error}</p>`;
            return;
        }

        renderWeather(data);

    } catch (err) {
        document.getElementById("result").innerHTML =
            `<p class='text-center text-red-300 text-xl'>Error fetching weather</p>`;
    }
}


function renderWeather(data) {
    let html = `
        <div class="text-center mb-8">
            <h2 class="text-3xl font-bold">${data.city}, ${data.country}</h2>
            <p class="text-lg opacity-80">Lat: ${data.latitude}, Lon: ${data.longitude}</p>
        </div>

        <!-- Current Weather -->
        <div class="bg-white/30 p-6 rounded-2xl text-center mb-8">
            <p class="text-2xl font-semibold">Current Weather</p>
            <p class="text-5xl my-3">${data.current.temperature}Â°</p>
            <p class="text-xl">${data.current.weather_description}</p>
            <p class="opacity-70 mt-1">Wind: ${data.current.windspeed} km/h</p>
        </div>

        <h3 class="text-2xl font-semibold mb-4">7-Day Forecast</h3>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    `;

    data.forecast.forEach(day => {
        html += `
            <div class="bg-white/20 p-5 rounded-2xl shadow">
                <p class="text-xl font-bold mb-2">${day.date}</p>
                <p class="text-lg">${day.description}</p>
                <p class="mt-2">Max: <span class="font-semibold">${day.max}Â°</span></p>
                <p>Min: <span class="font-semibold">${day.min}Â°</span></p>
            </div>
        `;
    });

    html += `</div>`;

    document.getElementById("result").innerHTML = html;
}

</script>

</body>
</html>

    <title>Weather App</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 min-h-screen flex flex-col items-center py-10">

    <h1 class="text-3xl font-bold mb-6">Weather App</h1>

    <!-- Input Section -->
    <div class="flex gap-4 mb-6">
        <input id="cityInput" type="text" placeholder="Enter city (pokhara, kathmandu, biratnagar)"
               class="px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
        <select id="unitSelect" class="px-4 py-2 border rounded-md">
            <option value="celsius">Celsius</option>
            <option value="fahrenheit">Fahrenheit</option>
        </select>
        <button id="fetchWeatherBtn"
                class="px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600">Get Weather</button>
    </div>

    <!-- Weather Display -->
    <div id="weatherDisplay" class="w-full max-w-xl bg-white p-6 rounded-md shadow-md hidden">
        <h2 id="cityName" class="text-2xl font-bold mb-4"></h2>
        <div id="currentWeather" class="mb-6">
            <p><strong>Latitude:</strong> <span id="lat"></span></p>
            <p><strong>Longitude:</strong> <span id="lon"></span></p>
            <p><strong>Elevation:</strong> <span id="elev"></span> m</p>
            <p><strong>Timezone:</strong> <span id="tz"></span></p>
        </div>

        <h3 class="text-xl font-semibold mb-2">7-Day Forecast</h3>
        <div id="forecast" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>

    <script>
        const fetchBtn = document.getElementById('fetchWeatherBtn');

        fetchBtn.addEventListener('click', async () => {
            const city = document.getElementById('cityInput').value.trim();
            const unit = document.getElementById('unitSelect').value;

            if (!city) return alert("Please enter a city.");

            const response = await fetch(`/api/current_weather/?city=${city}&unit=${unit}`);
            const data = await response.json();

            if (data.error) {
                alert(data.error);
                return;
            }

            // Show weather container
            const weatherDiv = document.getElementById('weatherDisplay');
            weatherDiv.classList.remove('hidden');

            // Current Weather
            document.getElementById('cityName').textContent = data.city;
            document.getElementById('lat').textContent = data.current.latitude;
            document.getElementById('lon').textContent = data.current.longitude;
            document.getElementById('elev').textContent = data.current.elevation;
            document.getElementById('tz').textContent = data.current.timezone;

            // Forecast
            const forecastDiv = document.getElementById('forecast');
            forecastDiv.innerHTML = '';
            data.forecast.forEach(day => {
                const card = document.createElement('div');
                card.className = 'p-4 bg-blue-100 rounded-md shadow';
                card.innerHTML = `
                    <p><strong>Date:</strong> ${day.date}</p>
                    <p><strong>Max:</strong> ${day.max}Â°</p>
                    <p><strong>Min:</strong> ${day.min}Â°</p>
                    <p><strong>Weather Code:</strong> ${day.weathercode}</p>
                `;
                forecastDiv.appendChild(card);
            });
        });
    </script>

</body>
</html>
